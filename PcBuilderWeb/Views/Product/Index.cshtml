@using Microsoft.AspNetCore.Mvc.TagHelpers
@using PcBuilder.Web.ViewModels.Product
@using static PcBuilder.Common.RolesValidation;
<link rel="stylesheet" href="~/css/ProductIndex.css" />

<div class="container">
    <h2>All Products</h2>
    @if (User.IsInRole(AdminRole))
    {
        <div class="add-product-btn mb-3">
            <a asp-action="AddProduct" class="btn btn-primary btn-block">Add New Product</a>
        </div>
    }

    <div class="table-container">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Image</th>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Added On</th>
                    <th>Manufacturer</th>
                    <th>Category</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            @foreach (AllProductsIndexViewModel product in Model)
            {
	            <tr>
		            <td>
			            <img src="@product.ImageUrl" alt="@product.ProductName" />
		            </td>
		            <td>
			            <span class="product-name">@product.ProductName</span>
		            </td>
		            <td>@product.ProductPrice.ToString("C")</td>
		            <td>@product.AddedOn</td>
		            <td>@product.ManufacturerName</td>
		            <td>@product.CategoryName</td>
		            <td>
			            <a asp-action="Details" asp-route-id="@product.Id" class="btn btn-info">Details</a>

			            @if (product.Quantity > 0)
			            {
				            @if (User.Identity.IsAuthenticated && User.IsInRole(UserRole))
				            {
					            <form asp-controller="Cart" asp-action="AddToCart" method="post" class="d-inline">
						            <input type="hidden" name="productId" value="@product.Id" />
						            <button type="submit" class="btn btn-primary">Add to Cart</button>
					            </form>
				            }
			            }
			            else
			            {
							@if (!User.IsInRole(AdminRole))
							{
								<span class="out-of-stock">Out of Stock!</span>
							}
			            }

			            @if (User.IsInRole(AdminRole))
			            {
				            
				            if (product.isDeleted)
				            {
					            <form asp-action="ToggleProductVisibility" asp-route-productId="@product.Id" method="post" class="d-inline">
						            <button type="submit" class="btn btn-success">Show</button>
					            </form>
				            }
				            else
				            {
					            <form asp-action="ToggleProductVisibility" asp-route-productId="@product.Id" method="post" class="d-inline">
						            <button type="submit" class="btn btn-danger">Hide</button> 
					            </form>
				            }
			            }
		            </td>
	            </tr>
            }
            </tbody>
        </table>
    </div>
</div>
